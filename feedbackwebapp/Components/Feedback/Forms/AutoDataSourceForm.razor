@namespace FeedbackWebApp.Components.Feedback.Forms
@using System.ComponentModel.DataAnnotations

<div class="auto-input-container" role="form" aria-labelledby="auto-input-title">
    <h3 id="auto-input-title" class="visually-hidden">URL Input Form</h3>
    <div class="auto-input-list">
        @for (var i = 0; i < Urls.Count; i++)
        {            
            var index = i;
            <div class="input-group mb-2">                
                <div class="form-floating flex-grow-1">
                    <input type="url" 
                           class="form-control" 
                           id="url-@index"
                           value="@Urls[index]"
                           @onchange="@(async (ChangeEventArgs e) => await HandleUrlChange(index, e.Value?.ToString() ?? ""))"
                           aria-label="URL for feedback source @(index + 1)" />
                    <label for="url-@index">Enter URL (YouTube, Reddit, GitHub, etc.)</label>
                </div>
                <button class="btn btn-outline-danger" 
                        @onclick="@(() => RemoveUrl(index))" 
                        type="button"
                        aria-label="Remove URL field @(index + 1)">
                    <i class="bi bi-x-lg" aria-hidden="true"></i>
                    <span class="visually-hidden">Remove URL</span>
                </button>
            </div>
        }
    </div>

    <button class="btn btn-outline-primary mb-3" 
            @onclick="AddUrl" 
            type="button"
            aria-label="Add another URL field">
        <i class="bi bi-plus-lg" aria-hidden="true"></i> Add Another URL
    </button>
</div>

@code {    
    private List<string> Urls { get; set; } = new() { "" };

    [Parameter]
    public EventCallback<List<string>> OnUrlsChanged { get; set; }

    public async Task HandleUrlChange(int index, string value)
    {
        Urls[index] = value;
        await OnUrlsChanged.InvokeAsync(Urls);
    }

    private void AddUrl()
    {
        Urls.Add("");
        StateHasChanged();
    }

    private async Task RemoveUrl(int index)
    {
        if (Urls.Count > 1)
        {
            Urls.RemoveAt(index);
            await OnUrlsChanged.InvokeAsync(Urls);
            StateHasChanged();
        }
    }

    public void RefreshUI() => StateHasChanged();
    
    public List<string> GetUrls() => Urls.Where(u => !string.IsNullOrWhiteSpace(u)).ToList();
}
